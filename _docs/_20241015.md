# 第4回：アナログ出力、シリアル通信

## 前回のおさらい

- 前回サンプルひと通りの振り返り
  - プルアップ・プルダウンの説明訂正
- 残りのサンプル・セクション
  - アナログ入力応用サンプル
  - Arduino IDEのシリアルプロッタの使い方
  - Arduino / RPi Pico W 各ボードについての説明補足

## Raspberry Pi Pico W の導入

### Arduino IDEのセットアップ、ファームウェアのアップデート

- Wiki の別ページで記載？

> 購入者がいなければスキップで良い

## アナログ出力（PWM）を使う

#### Arduino におけるアナログ出力とは？

これまでの講義内で、LEDやパワーリレーなどの外部のデバイスを制御する際には ```digitalWrite()``` を使ったON / OFFのみを行っていました。

Arduino 開発環境では、このようなON / OFFのみの制御以外に、連続的な数値（0~1023）を使って、指定したピンからこの数値に対応した任意の電圧を出力することができる ```analogWrite()``` という機能が存在します。

#### PWM

```analogWrite()``` は、多くの場合、厳密に言うと名前の通りの「アナログ波形の出力」ではなく、**PWM (= Pulse Width Modulation、パルス幅変調)** という技術を使った、一種の「疑似的な」アナログ出力です。

![図説等]()

- ピンアサインについて
  - > RPi Pico W 購入者がいる場合のみ
  - Arduino R3 / R4 でPWMが使えるピン
- DACを持っている開発ボードの補足
  - > R4の ```A0 / DA```

### LEDの明るさを段階的に変える

```analogWrite()``` を使って、LEDの明るさを段階的に変えてみます。

<details>
<summary>サンプルコード</summary>

</details>

- タクトスイッチで明るさを切り替える？

### LEDの明るさを連続的に変える

```analogWrite()``` を使って、LEDの明るさを連続的に変えてみます。

<details>
<summary>サンプルコード</summary>

</details>

- コード内で決めうちのフェードイン・フェードアウト
- フェード（トランジション）の色々なバリエーション
  - サイン波
- タクトスイッチでフェードのモードを切り替える？

### アナログ入力の値を反映させてみる

```analogRead()``` で得られる値を ```analogWrite()``` に反映させるスケッチを考えてみます。 

<details>
<summary>サンプルコード</summary>

</details>

- CdSセルの変化を直接反映させてみる
  - 値の補完（Interpolate）

### LED以外のデバイスを接続する

- モータードライバを使ったモーター制御（デモのみ）
- パワーリレーが使えないことの補足
- ...etc


## PCと連携させて使う：シリアル通信

- 簡単なプログラムからUSBシリアル経由でメッセージを送り、デバイスを制御する
  - Serialクラスの読み出し（ ```Serial.read()``` 系）を使う
- 制御側のアプリケーション・プログラミング環境
  - plugdata (Pure Data)
  - Processing
  - TouchDesigner

#### Arduino におけるシリアル通信とは？

これまでの講義内で、Arduino IDE でデジタル入力（タクトスイッチの例）およびアナログ入力（CdSセルの例）の数値を確認する手段として、シリアルモニタやシリアルプロッタを紹介してきました。

これらのIDE上の機能は、Arduino 開発環境における ```Serial``` クラス（関連性のあるの処理や機能をまとめて抽象化したもの）を通じて、開発ボード側からPCに対してテータを送信することで実現されています。

 ```Serial``` クラスには、送信だけでなく受信のための機能も実装されており、両方を使うことでPCを含む（開発ボード側から見た）外部機器との双方向通信を行うことができるようになります。

#### シリアル通信概説

- 言葉としての定義
- UART
- 電気的規格 / 通信方式
- USBにおけるシリアルデバイスクラス

### Arduino IDE からボード側にデータを送ってみる

Arduino IDE のシリアルモニタを使って簡単なコマンドを開発ボード側に送信し、LEDを制御してみます。

### xxx からボード側にデータを送受信してみる

```Serial``` クラスの機能を使ったPCとの通信は、対応しているものであれば Arduino IDE 以外でも可能です。

- PC側のソフトウェアのインストール・セットアップ
- とりあえず Processing / plugdata / TouchDesigner で単純なサンプル用意する。
  - 以降は
    - 音声系 - plugadata
    - 映像系 - Processing

### シリアル通信を使ったより複雑なコミュニケーション

```Serial``` クラスの機能を使ったPCとの通信を利用して、PCをこれまで使ってきたCdSセルやLEDなどの入出力デバイスの一種として扱うようなスケッチ / プログラムを考えてみます。

- 音声入力
- カメラ入力