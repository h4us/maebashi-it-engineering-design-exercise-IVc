# 第3回 

## タクトスイッチを使う - 前回のおさらい

前回授業のおさらいとして、タクトスイッチ動作確認のためのブレッドボード上の回路を再現して動かしてみます。

- 補足

## Arduinoのデジタル入力を使う：タクトスイッチ

### Arduinoを経由して、前回のLEDを光らせる回路を制御する

<details>
<summary>サンプルコード</summary>

```c++
// Arduinoの出力ピンにスケッチ内で使う別名を付ける
// 7番ピンを _SW1 という名前に、8番ピンを _LED1 という名前に
#define _SW1 7
#define _LED1 8

void setup() {
  // _SW1（7番ピン）を入力にする
  pinMode(_SW1, INPUT); 

  // _LED1（8番ピン）を出力にする
  pinMode(_LED1, OUTPUT);
}

void loop() { 
  // デジタル入力から読み取ったタクトスイッチの状態を使って、LEDの点灯状態を制御する
  digitalWrite(_LED1, digitalRead(_SW1)); 
 }
```
</details>

#### _ON / OFF を反転させてみる_

スケッチを書き換えることで、ブレッドボード上の配線を変更することなくタクトスイッチを押したときに挙動を反転させることができます。

<details>
<summary>サンプルコード</summary>

```c++
// Arduinoの出力ピンにスケッチ内で使う別名を付ける
// 7番ピンを _SW1 という名前に、8番ピンを _LED1 という名前に
#define _SW1 7
#define _LED1 8

void setup() {
  // _SW1（7番ピン）を入力にする
  pinMode(_SW1, INPUT); 

  // _LED1（8番ピン）を出力にする
  pinMode(_LED1, OUTPUT);
}

void loop() { 
  // デジタル入力から読み取ったタクトスイッチの状態を使って、LEDの点灯状態を制御する
  // 「!」という記号（論理否定演算子）を使って、押す・離すの挙動を反転させたバージョン
  digitalWrite(_LED1, !digitalRead(_SW1)); 
}
```
</details>

#### _Arduino内臓のプルアップ抵抗を使った方法_

Arduino内臓のプルアップ抵抗を使うようにすることで、ブレッドボード上の配線や外付け部品を減らすことが可能です。

<details>
<summary>サンプルコード</summary>

```c++
// Arduinoの出力ピンにスケッチ内で使う別名を付ける
// 7番ピンを _SW1 という名前に、8番ピンを _LED1 という名前に
#define _SW1 7
#define _LED1 8

void setup() {
  // _SW1（7番ピン）を入力にする・「プルアップ」バージョン
  pinMode(_SW1, INPUT_PULLUP);  

  // _LED1（8番ピン）を出力にする
  pinMode(_LED1, OUTPUT);
}

void loop() { 
  // デジタル入力から読み取ったタクトスイッチの状態を使って、LEDの点灯状態を制御する
  // 「!」という記号（論理否定演算子）を使って、押す・離すの挙動を反転させたバージョン
  digitalWrite(_LED1, !digitalRead(_SW1)); 
}
```
</details>

### Arduino IDEでデジタル入力の値を表示させてみる

シリアルモニタを使って、タクトスイッチの状態を Arduino IDE 上で可視化してみます。

![fig1-3]()

<details>
<summary>サンプルコード</summary>

```c++
// Arduinoの出力ピンにスケッチ内で使う別名を付ける
// 7番ピンを _SW1 という名前に、8番ピンを _LED1 という名前に
#define _SW1 7
#define _LED1 8

// デジタル入力読み取り用の変数（タクトスイッチの状態を記憶する領域）を設定する
int swState = 0;

void setup() {
  // _SW1（7番ピン）を入力にする・「プルアップ」バージョン
  pinMode(_SW1, INPUT_PULLUP);  

  // _LED1（8番ピン）を出力にする
  pinMode(_LED1, OUTPUT);

  // シリアルモニタ用の通信の初期化処理
  Serial.begin(19200);
}

void loop() {
  // デジタル入力から読み取ったタクトスイッチの状態を変数に記憶する
  swState = !digitalRead(_SW1); 

  // シリアルモニタに表示するメッセージ（改行なし）
  Serial.print("_SW1 State: ");
   // シリアルモニタに表示するメッセージ（改行あり） 
  Serial.println(swState);

  // 変数を使ってLEDの点灯状態を変える
  digitalWrite(_LED1, swState); 

  // 200ミリ秒待つ
  // （待ち時間を入れないと、タクトスイッチを押す・離すの動作による変化が早すぎてわかりにくいので）
  delay(200); 
}
```
</details>

### 応用：複数個のLEDとタクトスイッチでカウンタのようなものを作ってみる

例えば、複数個のLEDを異なる出力ピンに接続しておいて、タクトスイッチを押した回数に応じてどのLEDを点灯させるかを制御するようなスケッチを考えてみます。

![fig1-2]()

<details>
<summary>サンプルコード</summary>

```c++
// Arduinoの出力ピンにスケッチ内で使う別名を付ける
// 7番ピンを _SW1 という名前に、8番ピンを _LED1 という名前に、9番ピンを _LED2 という名前に
#define _SW1 7
#define _LED1 8
#define _LED2 9

// デジタル入力読み取り用の変数（タクトスイッチの状態を記憶する領域）を設定する
int swState = 0;

// カウンタ用の変数（カウントした数を記憶しておく）を設定する
int pushCount = 0;

void setup() {
   // _SW1（7番ピン）を入力にする・「プルアップ」バージョン
  pinMode(_SW1, INPUT_PULLUP);  

  // _LED1（8番ピン）を出力にする
  pinMode(_LED1, OUTPUT);
  // _LED2（9番ピン）を出力にする
  pinMode(_LED2, OUTPUT); 

  // シリアルモニタ用の通信の初期化処理
  Serial.begin(19200);
}

void loop() {  
  // デジタル入力から読み取ったタクトスイッチの状態を変数に記憶する
  swState = !digitalRead(_SW1);

  // タクトスイッチが押されたら1カウントアップする
  // 「%」という記号（余剰演算子）を使って、0・1・2・3と数えたらまた0に戻るようにする
  pushCount = (pushCount + swState) % 4;

  // シリアルモニタに表示するメッセージ（改行なし）
  Serial.print("_SW1 State: ");
   // シリアルモニタに表示するメッセージ（改行なし） 
  Serial.print(swState);
  // シリアルモニタに表示するメッセージ（改行なし）
  Serial.print(" , Count: ");
   // シリアルモニタに表示するメッセージ（改行あり） 
  Serial.println(pushCount);

  // 「&」という記号をビット演算子として使って、特定のカウントの時だけ点灯させる
  // （若干わかりにくい書き方なので、別の方法も後述します）
  digitalWrite(_LED1, pushCount & 1); // カウントが1・3の時だけ点灯
  digitalWrite(_LED2, pushCount & 2); // カウントが2・3の時だけ点灯
  
  // 200ミリ秒待つ
  // （待ち時間を入れないと、タクトスイッチを押す・離すの動作によるカウントアップが早すぎてわかりにくいので）
  delay(200); 
}
```
</details>


## Arduinoのアナログ入力を使う：CdSセル

![fig2-1]()

- CdSセルの説明

### Arduino IDEでアナログ入力の値を表示させてみる

[Arduino IDEでデジタル入力の値を表示させてみる](#arduino-ideでデジタル入力の値を表示させてみる) のスケッチを書き換えて、どのような値が入力されているかを確認します。

<details>
<summary>サンプルコード</summary>

```c++
//
void setup() {}
void loop() {}
//
```
</details>

### 入力値を使った条件分岐 - デジタル出力と組み合わせて使う

![fig2-2]()

### より複雑な条件分岐 - 複数の入力・出力を組み合わせて使う

![fig2-3]()

<details>
<summary>サンプルコード</summary>

```c++
//
void setup() {}
void loop() {}
//
```
</details>

#### _シリアルプロッタの使い方_

![fig2-4]()

<details>
<summary>サンプルコード</summary>

```c++
//
void setup() {}
void loop() {}
//
```
</details>


## 次回以降に使う開発ボードについて - Arduino と互換開発ボード

### Arduino IDE と開発ボードとしての Arduino について

#### そもそも「Arduino」とは？

> Arduino (/ɑːrˈdwiːnoʊ/) is an Italian open-source hardware and software company, project, and user community that designs and manufactures single-board microcontrollers and microcontroller kits for building digital devices.

> Arduino（アルドゥイーノ もしくは アルデュイーノまたはアルディーノ）とは、（ハードウェアの）「Arduinoボード」、および（ソフトウェアの）「Arduino IDE」から構成されるシステムである。

[Wikipedia(英)](https://en.wikipedia.org/wiki/Arduino) / [Wikipedia(日)](https://ja.wikipedia.org/wiki/Arduino)

- オープンソースのハードウェア（= この授業では「開発ボード」のひとつとして呼ぶ意味での Arduino）
- オープンソースの開発環境（= Arduino IDE、および関連ライブラリなど）

からなるシステムです。

- 現在の主流になっている歴史的な経緯
  
- Arduinoのバリエーションと互換ボードの紹介・概説

https://docs.arduino.cc/hardware/

### Raspberry Pi Pico について

#### Raspberry Pi プロジェクト

[Wikipedia(英)](https://en.wikipedia.org/wiki/Raspberry_Pi) / [Wikipedia(日)](https://ja.wikipedia.org/wiki/Raspberry_Pi)

#### Raspberry Pi Pico W

https://www.raspberrypi.com/documentation/microcontrollers/pico-series.html#picow-technical-specification


### Arduino と Raspberry Pi Pico W のどちらかを選択するにあたって

#### 動作電圧・消費電力

#### 価格と入手性

#### 開発のしやすさ・扱いやすさ

#### 開発ボードが標準で備えている機能