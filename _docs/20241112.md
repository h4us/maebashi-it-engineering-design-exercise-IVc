# 第8回：見えないネットワークをつくる - 様々な通信プロトコル・無線通信

サンプルコード

## Arduino における ```Serial``` クラス以外を用いた有線通信

### SPI / I2C

ホストPCと Arduino ボードの都の通信ではなく、基本的にマイコン間（およびマイコンを内蔵したセンサーや各種出力機器も含む）の通信に利用することを前提としたものです。

- 接続対象は同一の基板上に載っているか、ケーブル接続の場合でもごく短い距離での接続を想定しています。
- デバイスごとにマスター / スレーブという役割が割り振られ、実装によっては単一のI/Oインターフェースで１対１だけではなく、１対多（SPI / I2C）・多対多（I2C）での通信が可能になります。
- SPIは3線もしくは4線、I2Cは2線での配線が基本で、同期信号用の配線を必要とします。
- Arduino IDEではこれらの通信用にそれぞれ ```SPI```、```Wire``` というクラスが利用可能です。
  - ただし、多くの場合これらのクラスを拡張したり間接的に利用することでより簡単に接続対象のデバイスを扱えるようにしたライブラリがオンライン上に公開されています。ポピュラーなセンサーや出力機器であればライブラリを探して利用する、見つからなかったり特殊な使い方する場合は直接上記のクラスを用いてAPIを実装する、というような方法を取るのが妥当です。

#### デバイスの例

- 液晶表示機器（SPI）

<details>
<summary>サンプルスケッチ</summary>

```c++
```
</details>

- 温湿度センサ（I2C / DHT20）
- 加速度センサ（I2C / BMX055）
- 16チャンネルPWM / サーボドライバー（I2C / PCA9685）

<details>
<summary>サンプルスケッチ</summary>

```c++
```
</details>

### その他のUSB接続による通信

USBにはデバイスクラスという仕組みがあり、特定の役割をもつデバイスをデバイスクラスとして定義しておくことで、それらに準拠しておけば多くの場合OSが標準で提供するドライバで動作させることができるようになります（逆にそうではない場合は、各OSに合わせてドライバを開発し、ホストPCにインストールすることで初めて正しく動作せられるようになります）。

作品制作をする上で有益なデバイスクラスで、ライブラリ等が比較的整備されているものを挙げます。

#### HID（Human Interface Device）デバイスクラス (USB-HID)

- マウスやキーボードなどの入力デバイスとして振舞うことができるデバイスクラスです。

#### MIDIデバイスクラス (USB-MIDI)

- 多くの電子楽器で標準的に扱うことができるMIDIという通信規格に基づいた通信ができるデバイスクラスです。

---

## Wi-Fi

- IEEE 802.11*
  - 「.11」以降の英字は世代をあらわす（11a、11b、11g、11axなど）。
  - Wi-Fi 5 や Wi-Fi 6 などの簡易的な呼び方もある。
- 使用周波数帯域は 2.4GHz / 5GHz / 6GHz
- 周囲の他の電波状況や障害物などによるが、仕様上は見通し距離として100m程度まで通信可能。

<details>
<summary>サンプルスケッチ</summary>

```c++
```
</details>

---

## Bluetooth

- IEEE 802.15.1*
- 現在市販されている製品で多く採用されているのはver.4系かver.5系。ver.6の仕様が2024年9月に発表された。
- 使用周波数帯域は2.4GHz
- 基本的には10m前後までの近距離通信。
  - 電波強度によってクラス分けされており、クラスによっては100m以上離れて通信できる場合もある。
- 基本的には１対１の通信。
  - マルチポイント接続など、ハードウェア自体を特殊な構成にすることで多対接続を実現するような例外もある。
  - Bluetooth Mesh などの後発の機能拡張で多対接続を実現するような例外もある。
- 通信規格としては汎用的なものであり、実際に使用する際はプロファイルという概念に基づいて何かしら特定の役割を持ったデバイスとしてふるまうことになる。
  - USBデバイスクラスの仕組みに近い。
- Wi-Fiよりも基本的に低消費電力ではあるが、BLE（Bluetooth Low Energy）などさらに低消費電力に特化したモードも存在する。

<details>
<summary>サンプルスケッチ</summary>

```c++
```
</details>

---

## ZigBee

- IEEE 802.15.4
- 使用周波数帯域は2.4GHz / 915MHz / 868MHz。ただし日本国内では電波法等の関係で2.4GHzのみ使用可能。
- ネットワークに参加するデバイスをノードと呼び、デバイスごとに役割を割り振ることで、大規模なメッシュネットワークを構築できる。
- 通信距離は最大で70m程度。
- 低速だが省電力。

<details>
<summary>サンプルスケッチ</summary>

```c++
```
</details>

---